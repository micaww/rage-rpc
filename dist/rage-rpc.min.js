!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports=r():e.rpc=r()}("undefined"!=typeof self?self:this,(function(){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=1)}([function(e,r,t){"use strict";var n;function o(e,r){const t="client"===s();if(e&&"object"==typeof e&&void 0!==e.id){const o=(r,n,o)=>t?e.type===r&&n.at(e.id)===e:e instanceof o;switch(r){case n.Blip:return o("blip",mp.blips,mp.Blip);case n.Checkpoint:return o("checkpoint",mp.checkpoints,mp.Checkpoint);case n.Colshape:return o("colshape",mp.colshapes,mp.Colshape);case n.Label:return o("textlabel",mp.labels,mp.TextLabel);case n.Marker:return o("marker",mp.markers,mp.Marker);case n.Object:return o("object",mp.objects,mp.Object);case n.Pickup:return o("pickup",mp.pickups,mp.Pickup);case n.Player:return o("player",mp.players,mp.Player);case n.Vehicle:return o("vehicle",mp.vehicles,mp.Vehicle)}}return!1}function c(){const e=46656*Math.random()|0,r=46656*Math.random()|0;return("000"+e.toString(36)).slice(-3)+("000"+r.toString(36)).slice(-3)}function s(){return mp.joaat?"server":mp.game&&mp.game.joaat?"client":mp.trigger?"cef":void 0}function i(e){const r=s();return JSON.stringify(e,(e,t)=>{if("client"===r||"server"===r&&t&&"object"==typeof t){let e;if(o(t,n.Blip)?e=n.Blip:o(t,n.Checkpoint)?e=n.Checkpoint:o(t,n.Colshape)?e=n.Colshape:o(t,n.Marker)?e=n.Marker:o(t,n.Object)?e=n.Object:o(t,n.Pickup)?e=n.Pickup:o(t,n.Player)?e=n.Player:o(t,n.Vehicle)&&(e=n.Vehicle),e)return{__t:e,i:"number"==typeof t.remoteId?t.remoteId:t.id}}return t})}function a(e){const r=s();return JSON.parse(e,(e,t)=>{if(("client"===r||"server"===r)&&t&&"object"==typeof t&&"string"==typeof t.__t&&"number"==typeof t.i&&2===Object.keys(t).length){const e=t.i;let o;switch(t.__t){case n.Blip:o=mp.blips;break;case n.Checkpoint:o=mp.checkpoints;break;case n.Colshape:o=mp.colshapes;break;case n.Label:o=mp.labels;break;case n.Marker:o=mp.markers;break;case n.Object:o=mp.objects;break;case n.Pickup:o=mp.pickups;break;case n.Player:o=mp.players;break;case n.Vehicle:o=mp.vehicles}if(o)return o["client"===r?"atRemoteId":"at"](e)}return t})}function l(e,r){return"number"==typeof r?Promise.race([new Promise((e,t)=>{setTimeout(()=>t("TIMEOUT"),r)}),e]):e}function p(e){try{e.url}catch(e){return!1}return!0}t.d(r,"f",(function(){return c})),t.d(r,"a",(function(){return s})),t.d(r,"e",(function(){return i})),t.d(r,"c",(function(){return a})),t.d(r,"d",(function(){return l})),t.d(r,"b",(function(){return p})),function(e){e.Blip="b",e.Checkpoint="cp",e.Colshape="c",e.Label="l",e.Marker="m",e.Object="o",e.Pickup="p",e.Player="pl",e.Vehicle="v"}(n||(n={}))},function(e,r,t){"use strict";t.r(r),function(e){t.d(r,"register",(function(){return w})),t.d(r,"unregister",(function(){return v})),t.d(r,"call",(function(){return b})),t.d(r,"callServer",(function(){return P})),t.d(r,"callClient",(function(){return j})),t.d(r,"callBrowsers",(function(){return O})),t.d(r,"callBrowser",(function(){return x})),t.d(r,"on",(function(){return E})),t.d(r,"off",(function(){return S})),t.d(r,"trigger",(function(){return N})),t.d(r,"triggerClient",(function(){return L})),t.d(r,"triggerServer",(function(){return M})),t.d(r,"triggerBrowsers",(function(){return U})),t.d(r,"triggerBrowser",(function(){return T}));var n=t(0);const o=n.a();if(!o)throw"Unknown RAGE environment";const c="PROCEDURE_NOT_FOUND1",s="PROCEDURE_NOT_FOUND2",i="PROCEDURE_NOT_FOUND3",a="PROCEDURE_NOT_FOUND4",l="__rpc:id",p="__rpc:process",u="__rpc:browserRegister",f="__rpc:browserUnregister",m="__rpc:triggerEvent",g="__rpc:triggerEventBrowsers",d="cef"===o?window:e;if(!d[p]){if(d.__rpcListeners={},d.__rpcPending={},d.__rpcEvListeners={},d[p]=(r,t)=>{"server"!==o&&(t=r);const c=n.c(t);if(c.req){const t={id:c.id,environment:c.fenv||c.env};"server"===o&&(t.player=r);const s={ret:1,id:c.id,env:o};let i;switch(o){case"server":i=e=>t.player.call(p,[n.e(e)]);break;case"client":if("server"===c.env)i=r=>e.secureEvents?mp.events.call("__handle_rpc_proc",n.e(r)):mp.events.callRemote(p,n.e(r));else if("cef"===c.env){const e=c.b&&d.__rpcBrowsers[c.b];t.browser=e,i=r=>e&&n.b(e)&&h(e,r,!0)}break;case"cef":i=e=>mp.trigger(p,n.e(e))}if(i){const e=_(c.name,c.args,t);c.noRet||e.then(e=>i({...s,res:e})).catch(e=>i({...s,err:e||null}))}}else if(c.ret){const e=d.__rpcPending[c.id];if("server"===o&&e.player!==r)return;e&&(e.resolve(c.hasOwnProperty("err")?Promise.reject(c.err):Promise.resolve(c.res)),delete d.__rpcPending[c.id])}},"cef"!==o){if(mp.events.add(p,d[p]),"client"===o){w("__rpc:callServer",([e,r,t],n)=>y(e,r,{fenv:n.environment,noRet:t})),w("__rpc:callBrowsers",([e,r,t],n)=>R(null,e,r,{fenv:n.environment,noRet:t})),d.__rpcBrowsers={};const e=e=>{const r=n.f();Object.keys(d.__rpcBrowsers).forEach(r=>{const t=d.__rpcBrowsers[r];t&&n.b(t)&&t!==e||delete d.__rpcBrowsers[r]}),d.__rpcBrowsers[r]=e,e.execute(`\n                    window.name = '${r}';\n                    if(typeof window['${l}'] === 'undefined'){\n                        window['${l}'] = Promise.resolve(window.name);\n                    }else{\n                        window['${l}:resolve'](window.name);\n                    }\n                `)};mp.browsers.forEach(e),mp.events.add("browserCreated",e),d.__rpcBrowserProcedures={},mp.events.add(u,e=>{const[r,t]=JSON.parse(e);d.__rpcBrowserProcedures[t]=r}),mp.events.add(f,e=>{const[r,t]=JSON.parse(e);d.__rpcBrowserProcedures[t]===r&&delete d.__rpcBrowserProcedures[t]}),w(g,([e,r],t)=>{Object.values(d.__rpcBrowsers).forEach(n=>{B(n,m,[e,r],{fenv:t.environment,noRet:1})})})}}else void 0===d[l]&&(d[l]=new Promise(e=>{window.name?e(window.name):d[l+":resolve"]=e}));w(m,([e,r],t)=>C(e,r,t))}function h(e,r,t){const o=n.e(r);e.execute(`var process = window["${p}"]; if(process){ process(${JSON.stringify(o)}); }else{ ${t?"":`mp.trigger("${p}", '{"ret":1,"id":"${r.id}","err":"${c}","env":"cef"}');`} }`)}function _(e,r,t){const n=d.__rpcListeners[e];return n?Promise.resolve(n(r,t)):Promise.reject(s)}function w(e,r){if(2!==arguments.length)throw'register expects 2 arguments: "name" and "cb"';return"cef"===o&&d[l].then(r=>mp.trigger(u,JSON.stringify([r,e]))),d.__rpcListeners[e]=r,()=>v(e)}function v(e){if(1!==arguments.length)throw'unregister expects 1 argument: "name"';"cef"===o&&d[l].then(r=>mp.trigger(f,JSON.stringify([r,e]))),d.__rpcListeners[e]=void 0}function b(e,r,t={}){return arguments.length<1||arguments.length>3?Promise.reject('call expects 1 to 3 arguments: "name", optional "args", and optional "options"'):n.d(_(e,r,{environment:o}),t.timeout)}function y(r,t,c={}){switch(o){case"server":return b(r,t);case"client":{const s=n.f();return new Promise(i=>{c.noRet||(d.__rpcPending[s]={resolve:i});const a={req:1,id:s,name:r,env:o,args:t,...c};e.secureEvents?mp.events.call("__handle_rpc_proc",n.e(a)):mp.events.callRemote(p,n.e(a))})}case"cef":return j("__rpc:callServer",[r,t,+c.noRet])}}function P(e,r,t={}){if(arguments.length<1||arguments.length>3)return Promise.reject('callServer expects 1 to 3 arguments: "name", optional "args", and optional "options"');let o={};return t.noRet&&(o.noRet=1),n.d(y(e,r,o),t.timeout)}function k(e,r,t,c={}){switch(o){case"client":return b(r,t);case"server":{const s=n.f();return new Promise(i=>{c.noRet||(d.__rpcPending[s]={resolve:i,player:e});const a={req:1,id:s,name:r,env:o,args:t,...c};e.call(p,[n.e(a)])})}case"cef":{const e=n.f();return d[l].then(s=>new Promise(i=>{c.noRet||(d.__rpcPending[e]={resolve:i});const a={b:s,req:1,id:e,name:r,env:o,args:t,...c};mp.trigger(p,n.e(a))}))}}}function j(e,r,t,c={}){switch(o){case"client":if(c=t||{},t=r,r=e,e=null,arguments.length<1||arguments.length>3||"string"!=typeof r)return Promise.reject('callClient from the client expects 1 to 3 arguments: "name", optional "args", and optional "options"');break;case"server":if(arguments.length<2||arguments.length>4||"object"!=typeof e)return Promise.reject('callClient from the server expects 2 to 4 arguments: "player", "name", optional "args", and optional "options"');break;case"cef":if(c=t||{},t=r,r=e,e=null,arguments.length<1||arguments.length>3||"string"!=typeof r)return Promise.reject('callClient from the browser expects 1 to 3 arguments: "name", optional "args", and optional "options"')}let s={};return c.noRet&&(s.noRet=1),n.d(k(e,r,t,s),c.timeout)}function B(e,r,t,c={}){return new Promise(s=>{const i=n.f();c.noRet||(d.__rpcPending[i]={resolve:s}),h(e,{req:1,id:i,name:r,env:o,args:t,...c},!1)})}function R(e,r,t,c={}){switch(o){case"client":const o=d.__rpcBrowserProcedures[r];if(!o)return Promise.reject(i);const s=d.__rpcBrowsers[o];return s&&n.b(s)?B(s,r,t,c):Promise.reject(a);case"server":return k(e,"__rpc:callBrowsers",[r,t,+c.noRet],c);case"cef":return k(null,"__rpc:callBrowsers",[r,t,+c.noRet],c)}}function O(e,r,t,c={}){let s,i={};switch(o){case"client":case"cef":if(c=t||{},t=r,r=e,arguments.length<1||arguments.length>3)return Promise.reject('callBrowsers from the client or browser expects 1 to 3 arguments: "name", optional "args", and optional "options"');c.noRet&&(i.noRet=1),s=R(null,r,t,i);break;case"server":if(arguments.length<2||arguments.length>4)return Promise.reject('callBrowsers from the server expects 2 to 4 arguments: "player", "name", optional "args", and optional "options"');c.noRet&&(i.noRet=1),s=R(e,r,t,i)}if(s)return n.d(s,c.timeout)}function x(e,r,t,c={}){if("client"!==o)return Promise.reject("callBrowser can only be used in the client environment");if(arguments.length<2||arguments.length>4)return Promise.reject('callBrowser expects 2 to 4 arguments: "browser", "name", optional "args", and optional "options"');let s={};return c.noRet&&(s.noRet=1),n.d(B(e,r,t,s),c.timeout)}function C(e,r,t){const n=d.__rpcEvListeners[e];n&&n.forEach(e=>e(r,t))}function E(e,r){if(2!==arguments.length)throw'on expects 2 arguments: "name" and "cb"';const t=d.__rpcEvListeners[e]||new Set;return t.add(r),d.__rpcEvListeners[e]=t,()=>S(e,r)}function S(e,r){if(2!==arguments.length)throw'off expects 2 arguments: "name" and "cb"';const t=d.__rpcEvListeners[e];t&&t.delete(r)}function N(e,r){if(arguments.length<1||arguments.length>2)throw'trigger expects 1 or 2 arguments: "name", and optional "args"';C(e,r,{environment:o})}function L(e,r,t){switch(o){case"client":if(t=r,r=e,e=null,arguments.length<1||arguments.length>2||"string"!=typeof r)throw'triggerClient from the client expects 1 or 2 arguments: "name", and optional "args"';break;case"server":if(arguments.length<2||arguments.length>3||"object"!=typeof e)throw'triggerClient from the server expects 2 or 3 arguments: "player", "name", and optional "args"';break;case"cef":if(t=r,r=e,e=null,arguments.length<1||arguments.length>2||"string"!=typeof r)throw'triggerClient from the browser expects 1 or 2 arguments: "name", and optional "args"'}k(e,m,[r,t],{noRet:1})}function M(e,r){if(arguments.length<1||arguments.length>2)throw'triggerServer expects 1 or 2 arguments: "name", and optional "args"';y(m,[e,r],{noRet:1})}function U(e,r,t){switch(o){case"client":case"cef":if(t=r,r=e,e=null,arguments.length<1||arguments.length>2)throw'triggerBrowsers from the client or browser expects 1 or 2 arguments: "name", and optional "args"';break;case"server":if(arguments.length<2||arguments.length>3)throw'triggerBrowsers from the server expects 2 or 3 arguments: "player", "name", and optional "args"'}k(e,g,[r,t],{noRet:1})}function T(e,r,t){if("client"!==o)throw"callBrowser can only be used in the client environment";if(arguments.length<2||arguments.length>4)throw'callBrowser expects 2 or 3 arguments: "browser", "name", and optional "args"';B(e,m,[r,t],{noRet:1})}r.default={register:w,unregister:v,call:b,callServer:P,callClient:j,callBrowsers:O,callBrowser:x,on:E,off:S,trigger:N,triggerServer:M,triggerClient:L,triggerBrowsers:U,triggerBrowser:T}}.call(this,t(2))},function(e,r){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(e){"object"==typeof window&&(t=window)}e.exports=t}])}));